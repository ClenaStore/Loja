<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Clena Foods • Catálogo</title>
  <style>
    :root{
      --bg:#0e0f12; --panel:#14161a; --line:#262b36;
      --brand:#e63946; --brand-2:#ff8f1f;
      --txt:#f7f8fa; --muted:#cbd5e1;
      --shadow:0 12px 28px rgba(0,0,0,.35),0 2px 8px rgba(0,0,0,.25);
    }
    body{margin:0;background:var(--bg);color:var(--txt);font-family:Inter,system-ui,sans-serif;}
    header{padding:14px;border-bottom:1px solid var(--line);
      background:linear-gradient(180deg,#1a1f27,#14181f);
      font-weight:800;display:flex;align-items:center;gap:10px}
    header img{width:34px;height:34px;border-radius:8px;box-shadow:var(--shadow)}
    header h1{font-size:16px;margin:0}
    .btn{appearance:none;border:0;padding:8px 12px;border-radius:10px;
      background:linear-gradient(180deg,var(--brand-2),var(--brand));color:#fff;
      font-weight:700;cursor:pointer;text-align:center}
    .btn.secondary{background:linear-gradient(180deg,#2b3240,#1c222c);color:var(--txt)}
    /* Banner */
    .banner{position:relative;width:100%;height:200px;overflow:hidden}
    .banner img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;
      opacity:0;transition:opacity 1s ease}
    .banner img.active{opacity:1}
    /* Grid */
    .page{padding:16px;display:grid;gap:12px;grid-template-columns:1fr 1fr}
    @media(min-width:900px){.page{grid-template-columns:1fr 1fr 1fr}}
    .card{background:linear-gradient(180deg,#151921,#12161c);
      border:1px solid var(--line);border-radius:14px;overflow:hidden;
      box-shadow:var(--shadow);display:flex;flex-direction:column;cursor:pointer}
    .card img{width:100%;height:140px;object-fit:cover}
    .card .body{padding:10px;display:flex;flex-direction:column;gap:6px;flex:1}
    .card .name{font-weight:700}
    .card .price{color:#fcd34d;font-weight:700}
    /* Drawer carrinho */
    #cartDrawer{position:fixed;top:0;right:0;bottom:0;width:90vw;max-width:380px;
      background:linear-gradient(180deg,#161a22,#12161c);
      border-left:1px solid var(--line);transform:translateX(100%);
      transition:.28s ease;box-shadow:var(--shadow);display:flex;flex-direction:column;z-index:50}
    #cartDrawer.open{transform:translateX(0)}
    .drawerHead{padding:12px;font-weight:800;border-bottom:1px solid var(--line);display:flex;justify-content:space-between;align-items:center}
    .drawerBody{flex:1;overflow:auto;padding:12px;display:grid;gap:8px}
    .drawerFoot{padding:12px;border-top:1px solid var(--line);display:grid;gap:8px}
    .row{display:flex;justify-content:space-between;align-items:center;font-size:14px;gap:8px}
    .qty{display:flex;gap:6px;align-items:center}
    .qty button{width:24px;height:24px;border-radius:6px;background:#0f1115;
      border:1px solid var(--line);color:var(--txt);cursor:pointer}
    .mini{width:40px;height:40px;object-fit:cover;border-radius:6px}
    /* Popup */
    dialog{border:0;border-radius:14px;max-width:420px;width:90%;background:linear-gradient(180deg,#181b23,#13171d);color:var(--txt)}
    dialog::backdrop{background:rgba(0,0,0,.6)}
    .popup-body img{width:100%;max-height:200px;object-fit:cover;border-radius:10px;margin-bottom:8px}
    .comps{display:grid;gap:6px;margin-top:8px}
    label{font-size:14px;display:flex;justify-content:space-between;align-items:center}
    input,select,textarea{width:100%;padding:8px;border-radius:8px;background:#0f1115;border:1px solid var(--line);color:var(--txt)}
  </style>
</head>
<body>
  <header>
    <img src="https://github.com/ClenaStore/foods/blob/main/paste/ChatGPT%20Image%2027%20de%20ago.%20de%202025,%2019_35_02.png?raw=true" alt="logo">
    <h1>CLENA FOODS</h1>
    <button class="btn secondary" style="margin-left:auto" onclick="toggleCart(true)">🛒 <span id="cartBadge">0</span></button>
  </header>

  <!-- Banner -->
  <div class="banner">
    <img src="https://source.unsplash.com/1200x400/?burger" class="active">
    <img src="https://source.unsplash.com/1200x400/?fries">
    <img src="https://source.unsplash.com/1200x400/?soda">
  </div>

  <!-- Produtos -->
  <main class="page" id="menuGrid"></main>

  <!-- Drawer carrinho -->
  <aside id="cartDrawer">
    <div class="drawerHead">
      <span>Meu Carrinho</span>
      <button class="btn small secondary" onclick="toggleCart(false)">✖</button>
    </div>
    <div class="drawerBody" id="cartItems"></div>
    <div class="drawerFoot">
      <div class="row"><span>Total:</span><strong id="grandTotal">R$ 0,00</strong></div>
      <div style="display:grid;gap:6px">
        <select id="payMethod">
          <option value="">Forma de pagamento</option>
          <option value="pix">PIX</option>
          <option value="credito">Crédito</option>
          <option value="debito">Débito</option>
          <option value="dinheiro">Dinheiro</option>
        </select>
        <div id="trocoBox" style="display:none">
          <label>Troco para: <input id="trocoVal" placeholder="Ex.: 100"/></label>
        </div>
        <input id="clienteNome" placeholder="Seu nome"/>
        <input id="clienteTel" placeholder="WhatsApp"/>
        <textarea id="clienteEnd" placeholder="Endereço completo"></textarea>
        <textarea id="obs" placeholder="Observações"></textarea>
        <button class="btn" onclick="finalizar()">Enviar Pedido</button>
      </div>
    </div>
  </aside>

  <!-- Popup produto -->
  <dialog id="dlgItem">
    <div class="popup-body">
      <img id="pImg"><h3 id="pName"></h3><p id="pDesc" style="color:var(--muted)"></p>
      <strong id="pPrice"></strong>
      <div id="compBox"></div>
      <label>Quantidade: <input type="number" id="pQty" min="1" value="1" style="width:80px"></label>
      <div style="margin-top:8px;display:flex;gap:8px">
        <button class="btn" onclick="addCurrent()">Adicionar</button>
        <button class="btn secondary" onclick="dlgItem.close()">Cancelar</button>
      </div>
    </div>
  </dialog>

<script>
const API_URL="https://script.google.com/macros/s/AKfycbwbOlm3qbzOa89xKn9-MBQOnATbYOYGBJS-xMo2ppDEzWlX3qtvLzadysBdvo5o7dui/exec";
let menu=[],cart=[],current=null;
const $=s=>document.querySelector(s);
const BRL=v=>"R$ "+v.toFixed(2).replace(".",",");

// Banner loop
let bIx=0;const banners=document.querySelectorAll(".banner img");
setInterval(()=>{banners[bIx].classList.remove("active");bIx=(bIx+1)%banners.length;banners[bIx].classList.add("active")},4000);

// Carregar menu
async function loadMenu(){
  const r=await fetch(API_URL,{method:"POST",body:JSON.stringify({acao:"getMenu"})});
  const d=await r.json();
  if(d.ok){menu=d.items;renderMenu()}
}
function renderMenu(){
  const grid=$("#menuGrid");grid.innerHTML="";
  menu.forEach(i=>{
    const el=document.createElement("div");el.className="card";
    el.innerHTML=`<img src="${i.img}" alt=""><div class="body"><div class="name">${i.name}</div><div class="price">${BRL(i.price)}</div></div>`;
    el.onclick=()=>openItem(i);
    grid.appendChild(el);
  });
}
function openItem(i){
  current=i;
  $("#pImg").src=i.img;$("#pName").textContent=i.name;
  $("#pDesc").textContent=i.desc||"";$("#pPrice").textContent=BRL(i.price);
  $("#pQty").value=1;
  // complementos
  let html="";
  if(i.cat!=="Bebidas"&&i.cat!=="Complementos"){
    html="<h4>Complementos</h4><div class='comps'>";
    (i.comps||[]).forEach(c=>{html+=`<label><span>${c.name} +${BRL(c.price)}</span><input type='checkbox' data-id='${c.id}' data-price='${c.price}'></label>`});
    html+="</div>";
  }
  $("#compBox").innerHTML=html;
  $("#dlgItem").showModal();
}
function addCurrent(){
  const qty=Number($("#pQty").value)||1;
  const comps=[...$("#compBox input:checked")].map(c=>({id:c.dataset.id,name:c.parentNode.textContent.trim(),price:Number(c.dataset.price)}));
  const item={id:current.id,name:current.name,price:current.price,img:current.img,qty,comps};
  cart.push(item);
  $("#dlgItem").close();
  renderCart();toggleCart(true);
}
function renderCart(){
  $("#cartBadge").textContent=cart.length;
  const box=$("#cartItems");box.innerHTML="";
  let total=0;
  cart.forEach((it,ix)=>{
    let extras=it.comps?.map(c=>c.name).join(", ");
    const val=(it.price+(it.comps||[]).reduce((a,b)=>a+b.price,0))*it.qty;
    total+=val;
    const row=document.createElement("div");row.className="row";
    row.innerHTML=`<img src="${it.img}" class="mini"><div><b>${it.qty}× ${it.name}</b><div style="font-size:12px;color:var(--muted)">${extras||""}</div></div><strong>${BRL(val)}</strong>`;
    box.appendChild(row);
  });
  $("#grandTotal").textContent=BRL(total);
  $("#trocoBox").style.display=$("#payMethod").value==="dinheiro"?"block":"none";
}
function toggleCart(open){$("#cartDrawer").classList.toggle("open",open)}
$("#payMethod").addEventListener("change",()=>renderCart());

function finalizar(){
  if(!cart.length){alert("Carrinho vazio");return}
  const nome=$("#clienteNome").value.trim();
  const tel=$("#clienteTel").value.trim();
  const end=$("#clienteEnd").value.trim();
  if(!nome||!tel||!end){alert("Preencha nome, telefone e endereço");return}
  localStorage.setItem("cf_end",end);
  const pay=$("#payMethod").value;
  let msg=`*🍔 Pedido - Clena Foods*\n\n*Cliente:* ${nome}\n*Contato:* ${tel}\n*Endereço:* ${end}\n\n*Itens:*\n`;
  cart.forEach(it=>{
    let extras=it.comps?.map(c=>c.name).join(", ");
    const val=(it.price+(it.comps||[]).reduce((a,b)=>a+b.price,0))*it.qty;
    msg+=`• ${it.qty}× ${it.name} ${extras?`(${extras})`:""} — *${BRL(val)}*\n`;
  });
  msg+=`\n*Total:* ${$("#grandTotal").textContent}\n*Pagamento:* ${pay.toUpperCase()}`;
  if(pay==="dinheiro"&&$("#trocoVal").value){msg+=`\n*Troco para:* ${$("#trocoVal").value}`;}
  if($("#obs").value) msg+=`\n*Obs:* ${$("#obs").value}`;
  const url="https://wa.me/5577999999999?text="+encodeURIComponent(msg);
  window.open(url,"_blank");
}
loadMenu();
</script>
</body>
</html>
