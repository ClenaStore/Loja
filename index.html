<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>Bazar Online ‚Ä¢ Pagamento Seguro</title>
  <script src="https://sdk.mercadopago.com/js/v2"></script>
  <style>
    :root{
      --bg:#0f1724;--card:#0b1220;--accent:#ff8f1f;--muted:#9aa6b2;--white:#fff;--success:#16a34a;
      font-family:Inter,system-ui,"Segoe UI",Roboto,"Helvetica Neue",Arial;
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,#071022,#0f1724);color:var(--white);}
    header{padding:20px;text-align:center;background:rgba(255,255,255,0.03);box-shadow:0 2px 10px rgba(0,0,0,0.2)}
    h1{margin:0;font-size:26px;color:var(--accent)}
    .wrap{max-width:1100px;margin:0 auto;padding:20px;display:grid;gap:20px;grid-template-columns:2fr 1fr;}
    .produtos{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:18px;}
    .card{background:var(--card);padding:12px;border-radius:12px;box-shadow:0 6px 20px rgba(2,6,23,0.6);transition:.3s}
    .card:hover{transform:translateY(-3px);}
    .card img{width:100%;height:180px;object-fit:cover;border-radius:8px}
    .info{padding:8px 0}
    .info h3{margin:4px 0;font-size:17px}
    .info p{margin:0;font-size:13px;color:var(--muted)}
    .price{color:var(--accent);font-weight:700;margin:6px 0}
    button{background:var(--accent);border:none;padding:8px 12px;border-radius:8px;font-weight:700;cursor:pointer}
    #carrinho{background:var(--card);border-radius:12px;padding:16px;max-height:600px;overflow:auto;}
    #carrinho h2{font-size:18px;margin-top:0;color:var(--accent)}
    .item-carrinho{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .total{margin-top:12px;font-size:16px;font-weight:700;color:var(--success)}
    #finalizar{margin-top:10px;width:100%}
    footer{text-align:center;padding:10px;color:var(--muted);font-size:13px;margin-top:20px}
  </style>
</head>
<body>
  <header>
    <h1>üõçÔ∏è Bazar Online</h1>
    <p>Escolha seus produtos e pague online com Mercado Pago</p>
  </header>

  <div class="wrap">
    <section class="produtos" id="listaProdutos"></section>

    <aside id="carrinho">
      <h2>Seu Carrinho</h2>
      <div id="itensCarrinho"></div>
      <div class="total">Total: R$ <span id="totalCarrinho">0,00</span></div>
      <button id="finalizar">Pagar com Mercado Pago</button>
      <div id="mpCheckoutContainer" style="margin-top:10px"></div>
    </aside>
  </div>

  <footer>¬© 2025 Bazar Online ‚Ä¢ Pagamentos via Mercado Pago</footer>

  <script>
    const PUBLIC_KEY_MP = 'SEU_PUBLIC_KEY_MERCADOPAGO';
    const ENDPOINT_PRODUTOS = 'https://seu-gas-url/exec?action=listarProdutos';
    const ENDPOINT_CREATE_PREFERENCE = 'https://seu-backend.com/api/create_preference';

    const listaProdutos = document.querySelector('#listaProdutos');
    const itensCarrinho = document.querySelector('#itensCarrinho');
    const totalCarrinho = document.querySelector('#totalCarrinho');
    let carrinho = [];
    let mp = new MercadoPago(PUBLIC_KEY_MP,{locale:'pt-BR'});

    async function carregarProdutos(){
      try{
        const res = await fetch(ENDPOINT_PRODUTOS);
        const data = await res.json();
        renderProdutos(data);
      }catch(e){
        console.error('Erro ao carregar produtos',e);
        listaProdutos.innerHTML = '<p>Erro ao carregar produtos.</p>';
      }
    }

    function renderProdutos(data){
      listaProdutos.innerHTML = '';
      data.forEach(prod=>{
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <img src="${prod.foto}" alt="${prod.nome}">
          <div class="info">
            <h3>${prod.nome}</h3>
            <p>${prod.descricao}</p>
            <div class="price">R$ ${Number(prod.valor).toFixed(2)}</div>
            <button onclick='addCarrinho(${JSON.stringify(prod)})'>Adicionar</button>
          </div>`;
        listaProdutos.appendChild(card);
      });
    }

    function addCarrinho(prod){
      const existente = carrinho.find(i=>i.nome===prod.nome);
      if(existente) existente.qtd++;
      else carrinho.push({...prod,qtd:1});
      renderCarrinho();
    }

    function renderCarrinho(){
      itensCarrinho.innerHTML = '';
      let total=0;
      carrinho.forEach((item,i)=>{
        const div=document.createElement('div');
        div.className='item-carrinho';
        const subtotal=item.qtd*item.valor;
        total+=subtotal;
        div.innerHTML=`<span>${item.qtd}x ${item.nome}</span><strong>R$ ${subtotal.toFixed(2)}</strong>`;
        itensCarrinho.appendChild(div);
      });
      totalCarrinho.textContent=total.toFixed(2);
    }

    document.querySelector('#finalizar').addEventListener('click', async()=>{
      if(carrinho.length===0){alert('Carrinho vazio');return;}
      const items = carrinho.map(i=>({title:i.nome,quantity:i.qtd,unit_price:Number(i.valor)}));
      try{
        const resp = await fetch(ENDPOINT_CREATE_PREFERENCE,{
          method:'POST',headers:{'Content-Type':'application/json'},
          body:JSON.stringify({items})
        });
        const pref=await resp.json();
        if(pref.init_point) window.location.href=pref.init_point;
        else if(pref.preference_id) mp.checkout({preference:{id:pref.preference_id}});
        else alert('Erro ao iniciar pagamento.');
      }catch(err){
        alert('Erro ao criar pagamento: '+err);
      }
    });

    carregarProdutos();
  </script>
</body>
</html>
